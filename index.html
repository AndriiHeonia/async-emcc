<html>
<head>
  <title>Emcc async call demo</title>
  <script type="text/javascript">
    Module = {
      noExitRuntime: true
    };
  </script>
  <script type="text/javascript" src="out.js"></script>
</head>
<body>
  <script>
    window.onload = function() {

      var requestManager = {
        // we call this function from C++ code     
        sendRequest: function(ptrToCallbackCaller, ptrToCallbackObj) {
          console.log('call callback synchronously');
          Module.dynCall_vi(ptrToCallbackCaller, ptrToCallbackObj);

          setTimeout(function() {
            console.log('call callback asynchronously');
            Module.dynCall_vi(ptrToCallbackCaller, ptrToCallbackObj);
          }, 100);
        }
      };

      var ptrToSendRequest = Runtime.addFunction(requestManager.sendRequest);

      // init and run app
      var app = new Module['App'](ptrToSendRequest);
      app['run']();

    };
  </script>
</body>
</html>
