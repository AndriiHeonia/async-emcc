<html>
<head>
  <title>Emcc async call demo</title>
  <script type="text/javascript">
    Module = {
      noExitRuntime: true
    };
  </script>
  <script type="text/javascript" src="out.js"></script>
</head>
<body>
  <script>
    window.onload = function() {

      // we call this function from C++ code
      window.sendRequest = function(callback, cb) {
        console.log('call callback synchronously');
        Module.dynCall_vi(callback, cb);
  
        setTimeout(function() {
          console.log('call callback asynchronously');
          Module.dynCall_vi(callback, cb);
        }, 100);
      };
      
      var requestManager = {
        sendRequest: window.sendRequest
      };

      // init and run app
      var app = new Module['App']();
      app['run'](requestManager);

    };
  </script>
</body>
</html>
